<div #fullScreenContainer>
    <div class="dialog-header text-right mb-2">
        <!-- <h1 class="mr-2" mat-dialog-title>{{data.title}}</h1> -->
        <mat-icon class="mat-icon notranslate material-icons close-icon cursor-pointer" matprefix="" role="img" aria-hidden="true" [mat-dialog-close]="false">close</mat-icon>
    </div>
    <div *ngIf="customForm">
      <h1> {{data?.courseName}} </h1>
      <div class="w-full">
        <form [formGroup]="userDetailsForm" class="userDetailsForm">
            <div class="w-full" *ngIf="canShowGroup">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.group' | translate }}
                </div>
                <mat-form-field appearance="outline" class="w-full">
                    <mat-select formControlName="group" placeholder="{{ 'profileInfo.chooseAGroup' | translate }}">
                      <mat-option *ngFor="let group of groupData" value="{{group}}">{{ group }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowDesignation">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.designation' | translate }}
                </div>
                <mat-form-field appearance="outline" class="w-full">
                    <!-- <mat-select formControlName="designation" placeholder="Select designation">
                        <mat-option *ngFor="let designation of designationsMeta"
                          value="{{ designation?.name }}">{{ designation?.name }}</mat-option>
                      </mat-select> -->
                      <div class="flex flex-row auto-complete-row">
                        <input type="text" class="input-text" matInput formControlName="designation"
                         placeholder="{{ 'profileInfo.chooseADesignation' | translate }}" [matAutocomplete]="designationAuto">
                        <mat-icon class="disagnation-caret">arrow_drop_down</mat-icon>
                    </div>
                    <mat-autocomplete class="mat-autocomplete" #designationAuto="matAutocomplete">
                        <mat-option *ngFor="let designation of filterDesignationsMeta" value="{{ designation?.name }}">{{ designation?.name }}</mat-option>
                    </mat-autocomplete>
                    <mat-error *ngIf="userDetailsForm.controls['designation'].invalid && userDetailsForm.controls['designation'].touched"
                        class="mat-error">
                        Please enter a valid designation.
                    </mat-error>
                </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowName">
              <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.name' | translate }}
              </div>
              <mat-form-field appearance="outline" class="w-full">
                  <input type="text" class="input-text" matInput formControlName="name" placeholder="Name"/>
              </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowEmail">
              <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.email' | translate }}
              </div>
              <mat-form-field appearance="outline" class="w-full">
                  <input type="text" class="input-text" matInput formControlName="primaryEmail" placeholder="Enter email"/>
              </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowOrg">
              <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.organisation' | translate }}
              </div>
              <mat-form-field appearance="outline" class="w-full">
                  <input type="text" class="input-text" matInput formControlName="organisation" placeholder="Organisation"/>
              </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowEmployeeCode">
                <div class="mat-subheading-2 margin-0 required"
                    i18n="Title label|Label which explains the user to enter title">
                    {{ 'profileInfo.employeeId' | translate }}
                </div>
                <mat-form-field appearance="outline" class="w-full">
                    <input type="text" class="input-text" matInput formControlName="employeeCode" placeholder="Enter employee code"/>
                    <mat-error class="text-xs" *ngIf="userDetailsForm.get('employeeCode').hasError('pattern')">
                        Please enter an Alpha-numeric value only
                    </mat-error>
                </mat-form-field>                    
            </div>
            <div class="w-full" *ngIf="canshowMobile">
              <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.mobileNumber' | translate }}
              </div>
              <div class="flex flex-row gap-4">
                <div class="country-code" appearance="outline">
                  +91
                </div>
                <div class="flex-1">
                  <div class="flex flex-col">
                    <mat-form-field appearance="outline" class="profile-form-field mobile-num">
                      <input type="text" class="input-text mobile-text relative" maxlength="10" (keyup)="handleEmpty('mobile')"
                        matInput formControlName="mobile" placeholder="Enter mobile number"/>
                        <mat-icon class="verified-check" *ngIf="mVerified">check_circle</mat-icon>
                    </mat-form-field>
                    <mat-error class="text-xs"
                        *ngIf="userDetailsForm.get('mobile').hasError('required') || userDetailsForm.get('mobile').hasError('pattern')">
                          {{ 'profileInfo.pleaseEnterValidMobileNumber' | translate }}
                      </mat-error>
                  </div>
                  <div class="flex justify-end" *ngIf="verifyMobile && !otpSent && !mVerified">
                    <span class="get-otp sm:mr-4" (click)="handleGenerateOTP('phone')">{{ 'profileInfo.getOTP' |
                      translate }}</span>
                  </div>
                </div>
              </div>
              <div *ngIf="otpSent">             
                <form [formGroup]="otpForm">
                  <div class="w-full">
                    <div class="flex enter-otp">
                      <div class="mat-subheading-2 required"
                        i18n="Title label|Label which explains the user to enter title">
                        {{ 'profileInfo.enterOTP' | translate }}
                      </div>
                      <div class="mb-3">Time Remaining: <span #timerDiv></span></div>
                    </div>
                    <mat-form-field appearance="outline" class="profile-form-field mobile-num">
                      <input type="text" matInput formControlName="otp" class="input-text custom-size" placeholder="{{ 'profileInfo.enterTheOTP' | translate }}" maxlength="6" />
                    </mat-form-field>
                  </div>
                  <div class="w-full">
                    <div class="flex justify-center" *ngIf="showResendOTP">  
                      <div class="flex flex-row">
                          <div class="timer">{{ 'profileInfo.didNotReceiveOTP' | translate }}</div>
                          <div class="resend-otp" (click)="handleResendOTP()">&nbsp;&nbsp;{{ 'profileInfo.resentOTP' | translate }}</div>
                      </div>
                    </div>
                  </div>
                  <div class="w-full mb-4">
                    <div class="flex flex-row justify-between">
                      <button class="save-button" (click)="verifyMobileOTP()">{{ 'profileInfo.submit' | translate }}</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          <div class="w-full" *ngIf="canShowGender">
              <div class="mat-subheading-2 margin-0 required"
                i18n="Title label|Label which explains the user to enter title">
                {{ 'profileInfo.gender' | translate }}
              </div>
              <mat-form-field appearance="outline" class="w-full">
                  <mat-select formControlName="gender" placeholder="Select gender">
                      <mat-option *ngFor="let _gender of eUserGender" value="{{ _gender }}">{{
                        handleTranslateTo(_gender.toLowerCase()) }}</mat-option>
                  </mat-select>
              </mat-form-field>
            </div>
              <div class="w-full" *ngIf="canShowDob">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.dob' | translate }}
                </div>
                <mat-form-field appearance="outline" class="w-full">
                    <input matInput class="input-text icon-include-input" [max]="currentDate" [matDatepicker]="picker" [(ngModel)]="selectedDate"
                  formControlName="dob" placeholder="Select date of birth" />
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowDomicileMedium">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.motherTongue' | translate }}
                </div>
                <mat-form-field appearance="outline" class="w-full">
                    <div class="flex flex-row auto-complete-row">
                      <input type="text" class="input-text" aria-label="Domicile Medium (Mother Tongue)" matInput 
                        formControlName="domicileMedium" [matAutocomplete]="languageAuto" placeholder="Select mother tongue" />
                      <mat-icon class="mother-toungue-caret">arrow_drop_down</mat-icon>
                    </div>
                    <mat-autocomplete #languageAuto="matAutocomplete">
                      <mat-option *ngFor="let language of masterLanguages" [value]="language.name">
                        {{ language.name }}
                      </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
              <div class="w-full" *ngIf="canShowCategory">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.category' | translate }}
                </div>
                <mat-form-field appearance="outline" class="w-full">
                    <mat-select formControlName="category" placeholder="Select category">
                      <mat-option *ngFor="let category of eCategory" value="{{ category }}">{{
                        handleTranslateTo(category?.toLowerCase()) }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowpinCode">
                <div class="mat-subheading-2 margin-0 required"
                    i18n="Title label|Label which explains the user to enter title">
                    {{ 'userProfile.officePinCode' | translate }}
                </div>
                <mat-form-field appearance="outline" class="w-full">
                    <input type="email" class="input-text" matInput maxlength="6" formControlName="pinCode" placeholder="Enter pincode"/>
                    <mat-error class="text-xs" *ngIf="userDetailsForm.get('pinCode').hasError('pattern')">
                        {{ 'profileInfo.invalidPinCode' | translate }}
                        </mat-error>
                </mat-form-field>                    
            </div>
            <div class="w-full" *ngIf="canShowshowCadreDetails">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.isCadre' | translate }}
                </div>
                <mat-form-field appearance="outline" class="profile-form-field">
                    <mat-select formControlName="isCadre" (selectionChange)="getIsCadreStatus($event.value)" placeholder="Select cadre">
                      <mat-option [value]="true">Yes</mat-option>
                      <mat-option [value]="false">No</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="w-full" *ngIf="canShowshowCadreDetails && isCadreStatus">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.typeOfCivilService' | translate }}
                </div>
                <mat-form-field appearance="outline" class="profile-form-field">
                    <mat-select formControlName="typeOfCivilService" (selectionChange)="getService($event.value)"  placeholder="Select type of civil service">
                      <mat-option *ngFor="let service of civilServiceTypes" [value]="service">{{ service }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="w-full" *ngIf="canShowshowCadreDetails && userDetailsForm.get('typeOfCivilService').value && userDetailsForm.get('isCadre').value">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.serviceType' | translate }}
                </div>
                <mat-form-field appearance="outline" class="profile-form-field">
                    <mat-select formControlName="serviceType" (selectionChange)="onServiceSelect($event)" placeholder="Select service">
                        <mat-option *ngFor="let service of serviceName" [value]="service">{{ service }}</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <div class="w-full" *ngIf="canShowshowCadreDetails && userDetailsForm.get('serviceType').value && 
                userDetailsForm.get('isCadre').value 
                && userDetailsForm.get('typeOfCivilService').value && (
                    userDetailsForm.get('serviceType').value === 'Indian Administrative Service (IAS)' || 
                    userDetailsForm.get('serviceType').value === 'Indian Police Service (IPS)' || 
                    userDetailsForm.get('serviceType').value === 'Indian Forest Service (IFoS)' 
                  )">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.cadre' | translate }}
                </div>
                <mat-form-field appearance="outline" class="profile-form-field">
                    <mat-select formControlName="cadreName" (selectionChange)="onCadreSelect($event.value)" placeholder="Select cadre">
                        <mat-option *ngFor="let state of cadre" [value]="state">{{ state }}</mat-option>
                      </mat-select>
                  </mat-form-field>
            </div>

            <div class="w-full" *ngIf="canShowshowCadreDetails && userDetailsForm.get('serviceType') && (userDetailsForm.get('serviceType').value && 
            userDetailsForm.get('isCadre').value && userDetailsForm.get('typeOfCivilService').value && (
                userDetailsForm.get('serviceType').value === 'Indian Administrative Service (IAS)' || 
                userDetailsForm.get('serviceType').value === 'Indian Police Service (IPS)' || 
                userDetailsForm.get('serviceType').value === 'Indian Forest Service (IFoS)' 
            ) && userDetailsForm.get('cadreName').value)  ? true : ((userDetailsForm.get('serviceType').value && 
                userDetailsForm.get('isCadre').value 
            && userDetailsForm.get('typeOfCivilService').value && (
                userDetailsForm.get('serviceType').value !== 'Indian Administrative Service (IAS)' && 
                userDetailsForm.get('serviceType').value !== 'Indian Police Service (IPS)' && 
                userDetailsForm.get('serviceType').value !== 'Indian Forest Service (IFoS)' 
            ))) ? true : false">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.batch' | translate }}
                </div>
                <mat-form-field appearance="outline" class="profile-form-field">
                    <mat-select formControlName="cadreBatch" placeholder="Select batch">
                        <mat-option *ngFor="let year of yearArray" [value]="year">{{ year }}</mat-option>
                    </mat-select>
                  </mat-form-field>
            </div>
            <div class="w-full" *ngIf="canShowshowCadreDetails && userDetailsForm.get('isCadre').value &&  userDetailsForm.get('cadreBatch').value">
                <div class="mat-subheading-2 margin-0 required"
                  i18n="Title label|Label which explains the user to enter title">
                  {{ 'profileInfo.cadreControllingAuthority' | translate }}
                </div>
                <span class="cadreControl-name">{{cadreControllingAuthority}}</span>
            </div>
            <ng-container *ngIf="showCounter !== disableCounter">
              <div class="w-full flex flex-row gap-4 justify-end margin-top-m">
                <button
                  class="save-button"
                  [disabled]="userDetailsForm?.invalid || (showMobile && !mVerified)"
                  (click)="onSubmitForm(userDetailsForm)">
                  {{ 'profileInfo.saveChanges' | translate }}
                </button> 
              </div>
            </ng-container>
            <ng-container *ngIf="showCounter === disableCounter">
              <div class="w-full flex flex-row gap-4 justify-end margin-top-m">
                <button
                  class="save-button"
                  (click)="onSubmitForm(userDetailsForm)">
                  {{ 'apptocsinglepage.next' | translate }}
                </button>
              </div>
            </ng-container>
        </form>
      </div>
   </div>
   <div *ngIf ="!customForm && !isLoading">
       <lib-micro-survey class="course-survey"
           [apiData]="data?.apiData"
           [afterSubmitAction]="afterSubmitAction"
           [isReadOnly]="isReadOnly"
           [surveyId]="data?.surveyId"
           [courseId]="data?.courseId"
           [courseName]="data?.courseName"
           [isblendedprogram]="true"
           [customTextAreaRows]="1"
           >
       </lib-micro-survey>
   </div>
</div>
